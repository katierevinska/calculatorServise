# О проекте
В данном репозитории представлен учебный проект "Сервис подсчёта арифметических выражений" 

Он представляет собой веб-сервис, с помощью которого пользователь отправляет арифметическое выражение по HTTP и получает в ответ его результат.



# Back-end часть
Состоит из 2 элементов: оркестратор, который принимает арифметическое выражение, переводит его в набор последовательных задач и 
агент, который бужет просить в ручку GET internal/task/new задачи у оркестратора, выполнять их и возвращать результат в ручку POST internal/task. При старте агент запускает несколько горутин, каждая из которых выступает в роли независимого вычислителя. Количество горутин регулируется переменной среды COMPUTING_POWER

# Детали использования
У сервиса есть endpoint с url-ом /api/v1/calculate, куда можно отправлять запросы вида:
```json
{
    "expression": "2+2*4"
}
```
(значением expression может являться и любая строка представляющая арифметическое выражение)

формат тела HTTP-ответа:
```json
{
    "id": <уникальный идентификатор выражения>
}
```
c кодом 200, по которому можно узнавать состояние вычислений данного выражения

При работе с консолью ос Windows можно использовать следующую стандартную команду
```
curl --location "http://localhost:8080/api/v1/calculate" ^
--header "Content-Type: application/json" ^
--data "{\"expression\": \"2+2*4\"}"
```
Если входные данные не соответствуют требованиям приложения то ответом на такой запрос будет:
```json
{
    "error": "Expression is not valid"
}
```
c кодом 422


Получение списка выражений (к ним относятся только те что поступали в ручку /api/v1/calculate)
curl --location 'localhost/api/v1/expressions'
Тело ответа
```json
[
    {
        "id": "id2",
        "status": "calculated",
        "result": "90.0000000000"
    },
    {
        "id": "id5",
        "status": "in progress",
        "result": ""
    }
]
```

Получение выражения по его идентификатору

curl --location 'localhost/api/v1/expressions/{id}'
Коды ответа:
200 - успешно получено выражение
404 - нет такого выражения

Тело ответа
```json
{
    "id": "id14",
    "status": "in progress",
    "result": ""
}
```

Получение задачи для выполнения
curl --location 'localhost/internal/task/new'
где формат таска
```json
{
    "id": <идентификатор задачи>,
    "arg1": <имя первого аргумента>,
    "arg2": <имя второго аргумента>,
    "operation": <операция>,
    "operation_time": <время выполнения операции>
}
```

Прием результата обработки данных.
curl --location 'localhost/internal/task' 
в формате 
```json
{
  "id": 1,
  "result": 2.5
}
```

## Что может вызвать ошибку "Expression is not valid":
- выражение подразумевает деление на 0
- в выражении встречаются символы русского/английского алфавита
- неверно расставленные скобки и т. п., что сделает вырожение не корректным для парсинга 


# Инструкция по запуску проекта:
в одном терминале из папки куда склонирован репозиторий выполнить команду для поднятия оркестратора 
```
go run ".\orchestrator\main.go" 
```
потом открыть другой терминал из которого выполнить команду по поднятию агента
```
go run ".\agent\main.go" 
```

Время выполнения операций задается переменными среды в миллисекундах
- TIME_ADDITION_MS - время выполнения операции сложения в миллисекундах
- TIME_SUBTRACTION_MS - время выполнения операции вычитания в миллисекундах
- TIME_MULTIPLICATIONS_MS - время выполнения операции умножения в миллисекундах
- TIME_DIVISIONS_MS - время выполнения операции деления в миллисекундах


